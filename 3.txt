
import org.apache.hadoop.conf.*; 
import org.apache.hadoop.fs.*; 
import org.apache.hadoop.io.*; 
import org.apache.hadoop.mapreduce.*; 
import org.apache.hadoop.mapreduce.lib.input.*; 
import org.apache.hadoop.mapreduce.lib.output.*; 

public class WMR {

    public static class WeatherMapper extends Mapper<Object, Text, Text, Text> {
        public void map(Object k, Text v, Context c) throws java.io.IOException, InterruptedException {
            String[] f = v.toString().split(",");
            double t = Double.parseDouble(f[1]);
            String w;
            if (t < 0) w = "Freezing";
            else if (t <= 15) w = "Cold";
            else if (t <= 25) w = "Warm";
            else w = "Hot";
            c.write(new Text(f[0]), new Text(w));
        }
    }

    public static class WeatherReducer extends Reducer<Text, Text, Text, Text> {
        public void reduce(Text k, Iterable<Text> v, Context c) throws java.io.IOException, InterruptedException {
            StringBuilder sb = new StringBuilder();
            for (Text x : v) sb.append(x).append(" ");
            c.write(k, new Text(sb.toString().trim()));
        }
    }

    public static void main(String[] a) throws Exception {
        Job j = Job.getInstance(new Configuration(), "Weather");
        j.setJarByClass(WMR.class);
        j.setMapperClass(WeatherMapper.class);
        j.setCombinerClass(WeatherReducer.class);
        j.setReducerClass(WeatherReducer.class);
        j.setOutputKeyClass(Text.class);
        j.setOutputValueClass(Text.class);
        FileInputFormat.addInputPath(j, new Path(a[0]));
        FileOutputFormat.setOutputPath(j, new Path(a[1]));
        System.exit(j.waitForCompletion(true) ? 0 : 1);
    }
}


Input (inputw.txt)
-
Australia,5
China,25
India,-3
Malaysia,30
Nepal,-4
Switzerland,-10


EXPECTED OUTPUT
-
Australia Cold
China Warm
India Freezing
Malaysia Hot
Nepal Freezing
Switzerland Freezing


STEPS 
-

1. Compile:
javac -source 8 -target 8 -cp "$(hadoop classpath)" WeatherMapReduce.java

2. Create JAR folder:
mkdir MM4
mv *.class MM4/

3. Make JAR:
jar -cvf MM4.jar -C MM4/ .

4. Upload input to HDFS:
hdfs dfs -mkdir /input3
hdfs dfs -put inputw.txt /input3

5. (If NameNode in safemode)
hdfs dfsadmin -safemode leave

6. Run the job:
hadoop jar MM4.jar WMR /input3 /output3

7. View output:
hdfs dfs -cat /output3/part-r-00000
